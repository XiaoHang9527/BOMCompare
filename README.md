# BOM比对工具 V1.1

这是一个用于比较两个BOM文件差异的工具，具备以下功能：

## 功能特点

1. **物料变更分析**：
   - 显示新增物料的详细信息
   - 报告移除物料的信息
   - 通过"→"箭头明确标识物料变更情况

2. **位号变更分析**：
   - 显示新增位号和移除位号的信息
   - 报告位号物料变更，包含详细的物料信息
   - 使用清晰的分类：
     - [常规替换] - 普通物料替换
     - [新物料替换] - 完全替换或引入新物料
     - [物料整合] - 多个物料整合

3. **位号重复问题**：
   - 报告BOM A和BOM B中的位号重复情况
   - 显示同一物料中的重复位号

4. **数量变更报告**：
   - 清晰展示物料数量变更情况
   - 使用"→"箭头标识数量变更前后的状态

5. **格式优化**：
   - 各分类之间添加空行，提高可读性
   - 使用一致的格式标识变更类型

6. **处理时间统计**：
   - 显示处理的开始时间、结束时间和总耗时

7. **进度显示**：
   - 在处理过程中显示进度条和状态信息

8. **报告格式控制**：
   - 控制报告中是否显示物料料号(MPN)信息
   - 支持显示替代料合并显示，提高报告可读性

9. **路径记忆功能**：
   - 自动记住上次文件选择的路径，提高文件选择效率
   - 配置信息保存并自动加载

10. **错误处理**：
    - 在对比过程中捕获并报告错误信息

## 使用方法

1. 运行程序后，选择两个需要对比的BOM文件：
   - 基准BOM(A)：作为对比基准的BOM文件
   - 对比BOM(B)：需要与基准文件进行对比的BOM文件

2. 点击"开始对比"按钮开始处理：
   - 界面底部会显示实时进度
   - 处理完成后会显示总耗时

3. 查看对比结果：
   - 结果窗口会显示详细的对比报告
   - 报告包含处理时间统计信息
   - 可以使用"保存结果"按钮保存报告

## 报告格式示例

```
====== BOM对比报告 ======

【基本信息】
文件A: Test_A_BOM.xlsx  (8行数据，7个物料，17个位号)
文件B: Test_B_BOM.xlsx  (9行数据，8个物料，17个位号)
处理时间: 2024-06-01 09:15:23 - 09:15:25 (耗时: 2秒)

【物料变更汇总】
新增物料: 2个
移除物料: 1个
物料数量变更: 3个

【位号变动详情】
新增位号: 2个
移除位号: 2个
变更位号: 3个

【位号变更[常规替换]】
1. C9001 → ABC300xxxx → ABC300yyyy

【位号变更[新物料替换]】
1. C9002 → ABC300xxxx → ABC301zzzz

【位号变更[物料整合]】
1. C9003, C9004 → ABC300xxxx, ABC300yyyy → ABC302aaaa

【新增位号】
1. C9005 → ABC303bbbb
2. C9006 → ABC303cccc

【移除位号】
1. C9007 → ABC300dddd
2. C9008 → ABC300eeee

【物料数量变更】
1. ABC300xxxx: 5 → 4  (-1)
   C9001, C9002, C9003
   
2. ABC300yyyy: 3 → 5  (+2)
   C9010, C9011, C9012, C9013, C9014
```

## 报告格式设置

在设置界面中可以控制报告的显示格式：

1. **在报告中显示物料料号(MPN)信息**：
   - 勾选：显示完整信息，如 `B2601 → ABC3000148 (BLM18PG181SN1D)`
   - 不勾选：显示简化信息，如 `B2601 → ABC3000148`

2. **替代料格式**：
   - 替代料会合并在同一行显示，如 `B2601 → ABC3000148 (BLM18PG181SN1D)/ABC3000006 (BLM18PG181SN1D)(替代料)`
   - 提高报告的可读性，明确标识替代料关系

## 注意事项

1. 支持的文件格式：Excel文件（.xlsx, .xls）
2. 必需的数据列：
   - Reference（位号）
   - P/N（料号）
   - Description（描述）
   - MPN（制造商料号）
3. 处理大文件时请耐心等待，进度条会显示实时进度
4. 程序会自动保存配置和上次文件选择的路径

## 更新日志

### 2025.04
- 优化报告格式，使用"→"箭头标识变更
- 改进位号变更分类，更加清晰地显示不同类型的替换
- 在各分类之间添加空行，提高报告可读性
- 简化配置，移除冗余字段映射

### 2025.03
- 新增报告格式控制功能，可选择是否显示物料料号(MPN)信息
- 改进替代料显示方式，同一位号的多个替代料合并显示
- 添加文件路径记忆功能，提高文件选择效率
- 优化窗口布局，主窗口自动居中显示
- 配置信息自动保存与加载
- 新增进度显示功能
- 新增处理时间统计
- 优化多线程处理，提升界面响应速度
- 改进位号重复检测逻辑，精确区分不同类型的重复情况
- 改进用户界面交互体验

## 系统要求

- Windows 7/8/10/11
- Python 3.6+
- 依赖库: pandas, openpyxl, tkinter

## 安装指南

1. 确保已安装Python 3.6或更高版本
2. 安装所需依赖:

```bash
pip install pandas openpyxl
```

3. 从项目目录运行程序:

```bash
python bom_comparer.py
```

## 使用说明

### 基本对比流程

1. 点击"浏览..."选择基准BOM(A)文件
2. 点击"浏览..."选择对比BOM(B)文件
3. 点击"开始对比"按钮
4. 查看对比结果
5. 可选: 点击"保存结果"将结果保存为文本文件

### 设置选项

1. 点击界面中的"设置"按钮，可以配置：
   - 各字段的映射关系
   - 报告中物料料号(MPN)的显示控制

### BOM文件格式要求

BOM文件需要包含以下必要列（列名不一定完全相同，程序会自动识别相似列名）：

- Item（序号）
- P/N（料号，物料编码）
- Reference（位号，参考位置）
- Description（描述）
- MPN（制造商料号，可选）

## 配置文件说明

配置文件采用JSON格式，包含以下字段：

```json
{
    "field_mappings": {
        "Item": ["Item", "序号", ...],
        "P/N": ["P/N", "料号", ...],
        "Reference": ["Reference", "位号", ...],
        "Description": ["Description", "描述", ...],
        "MPN": ["MPN", "制造商料号", ...]
    },
    "show_mpn_in_report": true,
    "last_dir": "D:/BOM文件路径"
}
```

### 字段说明

- **field_mappings**: BOM表头映射关系，用于识别不同BOM文件中的对应列。支持以下字段映射：
  - **序号**: 如`Item`, `序号`, `Number`等
  - **物料编号**: 如`P/N`, `料号`, `物料编码`, `Part Number`等
  - **位号**: 如`Reference`, `Ref`, `位号`等
  - **描述**: 如`Description`, `描述`, `物料描述`等
  - **制造商料号**: 如`MPN`, `Manufacturer P/N`, `制造商料号`等

- **show_mpn_in_report**: 控制报告中是否显示制造商料号信息
- **last_dir**: 记录上次打开文件的目录路径

## 常见问题

**Q: 为什么我的BOM无法正确加载?**  
A: 确保BOM文件包含所有必要字段，并且Item列为纯数字。

**Q: 如何处理多个物料共用一个位号的情况?**  
A: 本工具支持单个位号对应多个物料的情况，会在报告中正确显示为替代料关系。

**Q: 系统如何区分"同一物料的位号重复"和"位号对应多个物料"?**  
A: 系统会智能检测这两种情况：
   - 当同一物料在BOM文件中多次使用相同位号时，它会被归类为"同一物料位号重复"
   - 只有当不同物料使用相同位号时，才会被归类为"位号对应多个物料"的冲突情况
   - 替代料关系使用相同位号不会被视为冲突

**Q: 如何理解位号重复问题报告?**  
A: 位号重复问题分为两类：
   - "位号对应多个物料"表示同一位号被不同物料使用，可能是设计问题
   - "同一物料位号重复"表示某物料在BOM中重复列出了相同位号，通常是数据录入问题

**Q: 程序会记住上次选择的文件路径吗?**  
A: 是的，程序会自动记住上次选择的文件路径，下次打开时会默认定位到该路径。

**Q: 如何理解位号变更的不同分类?**  
A: 位号变更分为三类：
   - "[常规替换]" - 普通物料替换，使用常规物料进行替换
   - "[新物料替换]" - 引入全新物料进行替换，包括完全替换的情况
   - "[物料整合]" - 将多个不同物料整合为单一物料

**Q: 如何控制报告中的信息显示?**  
A: 在设置界面中可以控制是否显示物料料号(MPN)信息，根据需要调整报告的详细程度。

## 许可证

本软件仅供内部使用，未经授权不得外传。 